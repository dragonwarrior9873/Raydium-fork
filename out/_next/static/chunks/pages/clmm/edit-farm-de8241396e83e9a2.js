(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5118],{77742:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/clmm/edit-farm",function(){return n(57847)}])},475:function(e,t,n){"use strict";n.d(t,{u:function(){return r}});var a=n(62512),l=n(91371),s=n(42186),i=n(17097);async function r(){let e=l.ZP.getState().transactionPriority;if((0,i.hj)(e))return{units:6e5,microLamports:Math.ceil(e*10**s.kE.decimals*1e6/6e5)};{var t;let e=await (0,a.Z)("https://solanacompass.com/api/fees",{cacheFreshTime:3e5}),{avg:n}=null!==(t=null==e?void 0:e[15])&&void 0!==t?t:{};if(!n)return;return{units:6e5,microLamports:Math.min(Math.ceil(1e6*n/6e5),25e3)}}}},54531:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var a=n(85893);n(67294);var l=n(66180),s=n(70745),i=n(51800);function r(e){let{token1:t,token2:n,size:r,className:o,CoinAvatar1:d,CoinAvatar2:c}=e;return(0,a.jsxs)(i.Z,{className:(0,l.m)("-space-x-1",o),children:[(0,a.jsx)(s.Z,{size:r,token:t,...d}),(0,a.jsx)(s.Z,{size:r,token:n,...c})]})}},54630:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var a=n(85893),l=n(97664),s=n(87980),i=n(92224);function r(e){let{tokenSelectorProps:t,...n}=e,[r,{on:o,off:d}]=(0,i.ZP)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.Z,{...n,haveCoinIcon:!0,showTokenSelectIcon:!n.disableTokenSelect,onTryToTokenSelect:()=>{var e;o(),null===(e=n.onTryToTokenSelect)||void 0===e||e.call(n)}}),(0,a.jsx)(s.Z,{...t,disableTokens:n.disableTokens,enableTokens:n.enableTokens,canSelectQuantumSOL:n.canSelectQuantumSOL,open:r,onSelectToken:e=>{var t;d(),null===(t=n.onSelectToken)||void 0===t||t.call(n,e)},onClose:d})]})}},34495:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var a=n(85893),l=n(17097),s=n(27993),i=n(67294),r=n(66180),o=n(6994),d=n(54592),c=n(60421),m=n(51800);function u(e){var t,n,u;let{type:x="list-table",className:h,itemClassName:f,rowClassName:p,rowsWrapperClassName:v,headersWrapperClassName:b,list:w,labelMapper:j=Object.keys(w[0]).map(e=>({key:e,label:e})),onClickRow:g,getItemKey:k,renderRowItem:N,renderRowEntry:y,renderControlButtons:Z,renderItemActionButtons:T,renderPropertyLabel:C,onListChange:S}=e,{wrapped:P,controls:I}=function(e,t,n){var a;let l=e.map((e,n)=>null!==(a=t(e,n))&&void 0!==a?a:n).join("-"),[s,r]=(0,i.useState)(e),[o,d]=(0,i.useState)(null==n?void 0:n.searchText);(0,i.useEffect)(()=>{s!==e&&(null==r||r(e))},[l]),(0,i.useEffect)(()=>{var t;s!==e&&(null==n||null===(t=n.onListChange)||void 0===t||t.call(n,s))},[s]);let c=(0,i.useMemo)(()=>s.map((e,t)=>({data:e,destorySelf:()=>{r(e=>e.filter((e,n)=>n!==t))},changeSelf:e=>{r(n=>n.map((n,a)=>a===t?e:n))}})),[s]),m=(0,i.useMemo)(()=>({clear:()=>{r([]),d("")}}),[]);return{wrapped:c,controls:m}}(w,k,{onListChange:S}),R=(0,i.useRef)([]),E=(0,s.u)(j,[Object.keys(null!==(t=w[0])&&void 0!==t?t:{}),w[0]]),A={gridTemplateColumns:E.map(e=>null!==(n=e.cssGridItemWidth)&&void 0!==n?n:"1fr").join(" "),gap:4},D=(e,t)=>{let{data:n}=e;return"list-table"===x?(0,a.jsx)(c.Z,{className:(0,r.m)("text-[#abc4ff] text-xs font-medium py-4 px-5 -mx-5 items-center",(0,s.u)(p,[{index:t,item:n}])),style:A,onClick:()=>{null==g||g({index:t,item:n})},children:E.map(e=>{var s,i;let{key:r,label:o}=e,d=r&&(null===(s=Object.entries(n).find(e=>{let[t,n]=e;return((0,l.hj)(t)?String(t):t).includes(t)}))||void 0===s?void 0:s[1]),c=null===(i=R.current.find(e=>{let{label:t}=e;return t===o}))||void 0===i?void 0:i.el;return(0,a.jsx)("div",{className:f,style:{width:null==c?void 0:c.clientWidth,alignSelf:"stretch"},children:N?N({item:n,index:t,key:r,label:o,wholeDataList:w,allHeaders:R.current,header:c}):r?String(null!=d?d:""):""},o)})}):(0,a.jsx)("div",{className:(0,r.m)("bg-[#141041] p-3 divide-y divide-[#abc4ff1a]",(0,s.u)(p,[{index:t,item:n}])),onClick:()=>{null==g||g({index:t,item:n})},children:E.map(e=>{var s,i;let{key:o,label:d}=e,m=o&&(null===(s=Object.entries(n).find(e=>{let[t,n]=e;return((0,l.hj)(t)?String(t):t).includes(t)}))||void 0===s?void 0:s[1]),u=null===(i=R.current.find(e=>{let{label:t}=e;return t===d}))||void 0===i?void 0:i.el,x=N?N({item:n,index:t,key:o,label:d,wholeDataList:w,allHeaders:R.current,header:u}):o?String(null!=m?m:""):"";return(0,a.jsxs)(c.Z,{className:(0,r.m)("grid-cols-2 py-3",f),children:[(0,a.jsx)("div",{className:"grow text-xs font-semibold text-[#abc4ff80]",children:d}),(0,a.jsx)("div",{className:"text-[#abc4ff] text-xs font-medium",children:x},d)]},d)})})};return"list-table"===x?(0,a.jsxs)(o.Z,{className:(0,r.m)("grid bg-cyberpunk-card-bg border-1.5 border-[rgba(171,196,255,0.2)]",(null==w?void 0:w.length)>0?"":"rounded-bl-none rounded-br-none",h),size:"lg",children:[(0,a.jsx)(c.Z,{className:(0,r.m)("bg-[#141041] px-5 rounded-tr-inherit rounded-tl-inherit items-center",b),style:A,children:E.map((e,t)=>{let{key:n,label:l,renderLabel:s}=e;return(0,a.jsx)(i.Fragment,{children:null!==(u=null==C?void 0:C({key:n,label:l,wholeList:w}))&&void 0!==u?u:(0,a.jsx)("div",{ref:e=>R.current[t]={label:l,el:e},className:"grow text-xs font-semibold text-[#abc4ff80] py-3",children:s?s(w):l})},t)})}),(0,a.jsx)(d.Z,{className:(0,r.m)("px-5 divide-y divide-[#abc4ff1a]",v),children:P.map((e,t)=>{var n;let{data:s,destorySelf:i,changeSelf:r}=e,o=D({data:s,destorySelf:i,changeSelf:r},t),d=null==y?void 0:y({contentNode:o,destorySelf:i,changeSelf:r,itemData:s,index:t}),c=null==Z?void 0:Z({destorySelf:i,changeSelf:r,itemData:s,index:t}),m=null==T?void 0:T({destorySelf:i,changeSelf:r,itemData:s,index:t});return(0,a.jsx)("div",{className:"relative",children:null!=d?d:(0,a.jsxs)(a.Fragment,{children:[o,m,c&&(0,a.jsx)("div",{className:"absolute -right-10 top-1/2 -translate-y-1/2 translate-x-full",children:c})]})},(0,l.Kn)(s)&&null!==(n=null==s?void 0:s.id)&&void 0!==n?n:t)})})]}):(0,a.jsx)(c.Z,{className:(0,r.m)(h,v),children:P.map((e,t)=>{var n;let{data:i,destorySelf:d,changeSelf:c}=e,u=D({data:i,destorySelf:d,changeSelf:c},t),x=null==y?void 0:y({contentNode:u,destorySelf:d,changeSelf:c,itemData:i,index:t}),h=null==Z?void 0:Z({destorySelf:d,changeSelf:c,itemData:i,index:t}),f=null==T?void 0:T({destorySelf:d,changeSelf:c,itemData:i,index:t});return(0,a.jsx)(o.Z,{className:(0,r.m)("grid bg-cyberpunk-card-bg border-1.5 border-[rgba(171,196,255,0.2)] overflow-hidden",(0,s.u)(p,[{item:i,index:t}])),size:"lg",children:x?(0,a.jsx)("div",{className:"relative",children:x}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"relative",children:[u,f]}),(0,a.jsx)(m.Z,{children:h&&(0,a.jsx)(m.Z,{className:"grow justify-end py-3 px-5",children:h})})]})},(0,l.Kn)(i)&&null!==(n=null==i?void 0:i.id)&&void 0!==n?n:t)})})}},18074:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var a=n(81451),l=n(51523),s=n(84207),i=n(72573),r=n(99881);function o(e,t){try{var n,o;let d=(0,s.Z)(null!=e?e:0),c=d.mul((null==t?void 0:t.alreadyPercented)?1:100).toFixed(null!==(n=null==t?void 0:t.fixed)&&void 0!==n?n:2);if((0,a.eq)(d,0))return"0%";if(!(null==t?void 0:t.exact)&&c===0..toFixed(null!==(o=null==t?void 0:t.fixed)&&void 0!==o?o:2))return(null==t?void 0:t.alwaysSigned)?"<+0.01%":"<0.01%";return(null==t?void 0:t.alwaysSigned)?"".concat((0,a.gt)(c,0)?"+":"-").concat((0,r.Z)((0,a.gt)(c,0)?(0,i.B)(c):(0,i.B)((0,l.dC)(c,-1))),"%"):"".concat((0,r.Z)(c,{fractionLength:null==t?void 0:t.fixed}),"%")}catch(e){return"0%"}}},57847:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ev}});var a=n(85893),l=n(67294),s=n(11163),i=n(76248),r=n(94678),o=n(96662),d=n(31166),c=n(85830),m=n(91371),u=n(34003),x=n(98360),h=n(3363),f=n(51523),p=n(72305),v=n(14200),b=n(27713),w=n(475),j=n(79938),g=n(53002),k=n(94355),N=n(55469),y=n(62952);async function Z(e){let t,{currentAmmPool:n,updateRewards:a,newRewards:l,onTxSuccess:s}=e,{getToken:i}=d.ZP.getState(),r=await (0,x.ZP)(Array.from(a),async e=>{let[t,n]=e;return{programId:(0,v.D)(t),mint:(0,h.uI)(t),openTime:Math.floor(n.openTime.valueOf()/1e3),endTime:Math.floor(n.endTime.valueOf()/1e3),perSecond:(0,b.I2)(n.perSecond,20),amount:(0,y.n)(i(t),(0,f.dC)(n.perSecond,(n.endTime-n.openTime)/1e3)),rawAmount:(0,y.n)(i(t),n.amount,{alreadyDecimaled:!0})}}),c=await (0,x.ZP)(l,async e=>({programId:(0,v.D)(e.token.mint),mint:e.token.mint,openTime:Math.floor(e.openTime.valueOf()/1e3),endTime:Math.floor(e.endTime.valueOf()/1e3),perSecond:(0,b.I2)((0,f.hi)((0,f.dC)(e.perWeek||0,10**e.token.decimals),604800),20),amount:(0,y.n)(e.token,(0,f.dC)((0,f.hi)((0,f.dC)(e.perWeek||0,10**e.token.decimals),604800),(e.endTime.getTime()-e.openTime.getTime())/1e3)),rawAmount:(0,y.n)(e.token,e.amount,{alreadyDecimaled:!0})}));(0,u.Z)(n,"not seleted amm pool");let m=[...r.map(e=>e.rawAmount),...c.map(e=>e.rawAmount)],Z=[...r.map(e=>e.mint),...c.map(e=>e.mint)].some(e=>(0,v.W)(e)&&e);if(Z){let{hasConfirmed:e}=(0,N.e)({amount:m});t=await e}else t=!0;if(!t){k.Z.getState().logError("Canceled by User","The operation is canceled by user");return}return(0,j.ZP)(async e=>{let{transactionCollector:t,baseUtils:{connection:a,owner:i}}=e,{tokenAccountRawInfos:d,txVersion:m}=g.Z.getState(),u={connection:a,poolInfo:n.state,ownerInfo:{feePayer:i,wallet:i,tokenAccounts:d,useSOLBalance:!0}};if(r.length){let{chainTimeOffset:e}=o.ZP.getState(),a=((null!=e?e:0)+Date.now())/1e3,{innerTransactions:l}=await p.jsJ.makeSetRewardsInstructionSimple({...u,chainTime:a,rewardInfos:r,computeBudgetConfig:await (0,w.u)(),checkCreateATAOwner:!0,makeTxVersion:m,lookupTableCache:j.eq});t.add(l,{txHistoryInfo:{title:"Update rewards",description:"Update rewards in ".concat(n.idString.slice(0,6))},onTxSuccess:c.length?void 0:s})}if(c.length){let{innerTransactions:e}=await p.jsJ.makeInitRewardsInstructionSimple({...u,rewardInfos:c,computeBudgetConfig:await (0,w.u)(),checkCreateATAOwner:!0,makeTxVersion:m,lookupTableCache:j.eq});t.add(e,{txHistoryInfo:{title:"Added new rewards",description:"Added ".concat(l.map(e=>e.token.symbol).join(",")," to ").concat(n.idString.slice(0,6))},onTxSuccess:s})}})}var T=n(31555),C=n(43067),S=n(48162),P=n(51800),I=n(92618),R=n(66042),E=n(91148),A=n(4465),D=n(6994),F=n(54630),B=n(25194),M=n(60421),O=n(72259),L=n(56419),W=n(95793),U=n(90547),z=n(81451),H=n(14209),$=n(72573);function _(e){var t,n,s,i;let{dataIndex:r,defaultData:d,enableTokens:c,disableTokens:u,onValidateChange:x,onUpdateReward:h}=e,p=(0,m.ZP)(e=>e.isMobile),v=(0,o.ZP)(e=>e.chainTimeOffset),b=(0,g.Z)(e=>e.getBalance),[w,j]=(0,l.useState)(d||{}),k=(0,l.useRef)(r),N=Object.keys(w).length>0,y=new Date(Date.now()+(v||0)),Z=w.openTime&&w.endTime&&w.token?(0,f.hi)((0,U.g9)(w.endTime.valueOf(),w.openTime.valueOf())/1e3,10**w.token.decimals):void 0,T=w.token?void 0:"Confirm reward token",C=(0,z.Jr)(null===(t=w.amount)||void 0===t?void 0:t.pure)?"Enter ".concat(null===(n=w.token)||void 0===n?void 0:n.symbol," token amount"):void 0,S=!w.token||!w.amount||(0,z.eg)(b(w.token),(0,f.IH)(w.amount.pure,null!==(i=w.amount.fee)&&void 0!==i?i:0))?void 0:"Insufficient ".concat(w.token.symbol," balance"),I=w.amount&&(0,z.lt)(w.amount.pure,Z)?"Emission rewards is lower than min required":void 0,R=N?T||C||S||I:void 0,E=(0,l.useMemo)(()=>w.openTime&&w.duration?(0,z.gt)(w.duration,90)?"Period is longer than max duration of ".concat(90," days"):(0,z.lt)(w.duration,7)?"Period is shorter than min duration of ".concat(7," days"):void 0:"Confirm emission time setup",[w.duration,w.openTime]);return(0,l.useEffect)(()=>{x(r,T||C||S||I||E)},[T,C,E,I,S,w.amount,x,r]),(0,l.useEffect)(()=>{N&&j(e=>{var t,n,a,l;let s=null!==(l=null===(t=e.token)||void 0===t?void 0:t.decimals)&&void 0!==l?l:6,i=(0,z.$u)(null===(n=e.amount)||void 0===n?void 0:n.pure)&&(0,z.$u)(e.duration)?(0,H.Lu)((0,f.dC)((0,f.hi)(e.amount.pure,e.duration),7).toFixed(s)):"0";return{...e,endTime:(0,z.$u)(null===(a=e.openTime)||void 0===a?void 0:a.valueOf())&&(0,z.$u)(e.duration)?(0,L.mb)(e.openTime,{milliseconds:864e5*Number(e.duration)}):e.endTime,perWeek:i}})},[w.duration,w.openTime,w.amount,N]),(0,l.useEffect)(()=>{h(w,r)},[h,w,r]),(0,l.useEffect)(()=>{k.current!==r&&d&&j(d),k.current=r},[d,r]),(0,a.jsx)(D.Z,{className:"p-4 mb-4 mobile:p-3 bg-cyberpunk-card-bg border-1.5 border-[rgba(171,196,255,0.2)] ".concat(p?"rounded-2xl":"rounded-3xl"),size:"lg",children:(0,a.jsxs)(M.Z,{className:"gap-4",children:[(0,a.jsxs)(P.Z,{className:"gap-4 mobile:flex-col",children:[(0,a.jsx)(F.Z,{className:"rounded-md grow",haveHalfButton:!0,hasPlaceholder:!0,topLeftLabel:"Token",enableTokens:c,disableTokens:u,value:(null===(s=w.amount)||void 0===s?void 0:s.pure)!=null&&(0,$.B)(w.amount.pure)||"",token:w.token,onSelectToken:e=>j(t=>({...t,token:e,isWhiteListReward:!!c})),onUserInput:e=>{j(t=>{var n,a;let l=null!==(a=null===(n=t.amount)||void 0===n?void 0:n.fee)&&void 0!==a?a:0,s=(0,f.h9)(e,l);return{...t,amount:{total:e,pure:s,fee:l}}})},onCalculateTransferFee:e=>{j(t=>{var n,a;let l=null!==(a=null===(n=t.amount)||void 0===n?void 0:n.total)&&void 0!==a?a:e,s=(0,f.h9)(l,e);return{...t,amount:{total:l,pure:s,fee:e}}})}}),(0,a.jsx)(O.Z,{className:"grow-2 rounded-md text-sm font-medium text-white px-4",inputClassName:"placeholder:text-[#abc4ff50]",label:"Duration",inputMode:"numeric",inputHTMLProps:{min:1,maxLength:3,step:1},pattern:/^\d{0,5}$/,placeholder:"".concat(7," - ").concat(90),value:w.duration,suffix:(0,a.jsx)("div",{className:"font-medium text-sm text-[#abc4ff80]",children:"Days"}),onUserInput:e=>j(t=>({...t,duration:e}))})]}),R?(0,a.jsx)("div",{className:"text-[#DA2EEF] text-right text-sm font-medium px-2",children:R}):null,(0,a.jsxs)(P.Z,{className:"gap-3 mobile:flex-col",children:[(0,a.jsx)(B.Z,{className:"flex-[3] mobile:w-full rounded-md px-4",label:"Farming Starts",inputProps:{placeholder:"Select date and time",inputClassName:"text-sm font-medium text-white placeholder:text-[#abc4ff50]"},showTime:{format:"Select time: HH:mm UTC"},value:w.openTime?(0,L._3)(w.openTime):void 0,disableDateBeforeCurrent:!0,isValidDate:e=>(0,W.Sl)(e,(0,L.mb)(y,{seconds:-86400}))&&(0,W.hF)(e,(0,L.mb)(w.openTime||y,{seconds:7776e3})),onDateChange:e=>{e&&j(t=>({...t,openTime:(0,L._3)(e)}))}}),(0,a.jsx)(B.Z,{className:"flex-[3] mobile:w-full rounded-md px-4",label:"Farming Ends",inputProps:{placeholder:"Select date and time",inputClassName:"text-sm font-medium text-white placeholder:text-[#abc4ff50]"},showTime:{format:"Select time: HH:mm UTC"},value:w.endTime?(0,L._3)(w.endTime):void 0,disabled:!0,disableDateBeforeCurrent:!0}),(0,a.jsx)(O.Z,{label:"Estimated rewards / week",className:"flex-[3]",onUserInput:e=>{let t=(0,f.dC)((0,f.hi)(e,7),w.duration);j(n=>({...n,perWeek:e,amount:{total:t,pure:t,fee:void 0}}))},value:w.perWeek?(0,$.B)(w.perWeek):""})]}),(0,a.jsx)("div",{children:N&&(0,a.jsx)("div",{children:(0,z.gt)(w.duration,90)?(0,a.jsxs)("div",{className:"text-[#DA2EEF] text-sm font-medium  pl-2",children:["Period is longer than max duration of ",90," days"]}):(0,z.lt)(w.duration,7)?(0,a.jsxs)("div",{className:"text-[#DA2EEF] text-sm font-medium pl-2",children:["Period is shorter than min duration of ",7," days"]}):null})})]})})}async function q(e){let t,{claimableAmount:n,currentAmmPool:a,rewardInfo:l}=e,s=[l.tokenMint].some(e=>(0,v.W)(e)&&e);if(s){let{hasConfirmed:e}=(0,N.e)({amount:n});t=await e}else t=!0;if(!t){k.Z.getState().logError("Canceled by User","The operation is canceled by user");return}return(0,j.ZP)(async e=>{let{transactionCollector:t,baseUtils:{connection:n,owner:s}}=e,{tokenAccountRawInfos:i,txVersion:r}=g.Z.getState();(0,u.Z)(a,"not seleted amm pool");let o=a.rewardInfos.find(e=>e.tokenMint.equals(l.tokenMint)).rewardToken.symbol,{innerTransactions:d}=await p.jsJ.makeCollectRewardInstructionSimple({connection:n,poolInfo:a.state,ownerInfo:{feePayer:s,wallet:s,tokenAccounts:i,useSOLBalance:!0},rewardMint:l.tokenMint,associatedOnly:!1,computeBudgetConfig:await (0,w.u)(),checkCreateATAOwner:!0,makeTxVersion:r,lookupTableCache:j.eq});t.add(d,{txHistoryInfo:{title:"Harvested Reward",description:"Harvested: ".concat(o," reward")}})})}var G=n(11601),K=n(70745),V=n(54592),J=n(34495),X=n(99881),Q=n(18074),Y=n(83496),ee=n(6547),et=n(97664),en=n(6325),ea=n(84207);function el(e){var t,n;let{open:s,reward:i,disableEndTimeInput:r=!0,chainTimeOffset:o,onClose:d,onConfirm:c}=e,[u,x]=(0,g.Z)(e=>[e.getBalance,e.connected]),[h,p]=(0,l.useState)({amount:"",perWeek:""}),v=null!==(n=null==i?void 0:null===(t=i.rewardToken)||void 0===t?void 0:t.decimals)&&void 0!==n?n:6,b=new Date(Date.now()+(o||0)),{isRewardEnded:w}=i||{},j=!!((null==i?void 0:i.rewardToken)&&(0,z.eg)(u(i.rewardToken),h.amount));return(0,l.useEffect)(()=>{if(i){var e;p({amount:"",openTime:i.isRewardEnded?void 0:(0,L._3)(i.endTime),perWeek:(0,H.Lu)(null===(e=(0,f.dC)((0,f.hi)(null==i?void 0:i.perSecond,10**v),604800))||void 0===e?void 0:e.toFixed(v))})}},[i,v]),(0,l.useEffect)(()=>{p(e=>{let{duration:t,perWeek:n,...a}=e;if(w){var l;let e=(0,z.$u)(a.amount)&&(0,z.$u)(t)?(0,H.Lu)((0,f.dC)((0,f.hi)(a.amount,t),7).toFixed(v)):"";return{...a,duration:t,perWeek:e,endTime:(0,z.$u)(null===(l=a.openTime)||void 0===l?void 0:l.valueOf())&&(0,z.$u)(h.duration)?(0,L.mb)(a.openTime,{milliseconds:864e5*Number(h.duration)}):a.endTime}}return{...a,duration:t,perWeek:n,amount:n&&t?(0,H.Lu)((0,f.dC)((0,f.hi)(n,7),Number(t)).toFixed(v)):"0",endTime:(0,z.$u)(null==i?void 0:i.endTime.valueOf())&&(0,z.$u)(h.duration)?(0,L.mb)(null==i?void 0:i.endTime,{milliseconds:864e5*Number(h.duration)}):a.endTime}})},[h.duration,h.perWeek,w,v,null==i?void 0:i.endTime]),(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(en.Z,{placement:"from-bottom",open:s,onClose:d,children:e=>{var t,n;let{close:l}=e;return(0,a.jsxs)(D.Z,{className:"p-8 mobile:p-4 rounded-3xl mobile:rounded-lg w-[min(540px,90vw)] max-h-[80vh] overflow-auto mobile:w-full border-1.5 border-[rgba(171,196,255,0.2)] bg-cyberpunk-card-bg shadow-cyberpunk-card",size:"lg",children:[(0,a.jsx)(P.Z,{className:"justify-between items-center mb-6 mobile:mb-2",children:(0,a.jsx)("div",{className:"mobile:text-base text-xl font-semibold text-white",children:"Add more rewards"})}),(0,a.jsx)(V.Z,{children:(0,a.jsx)(et.Z,{className:"mb-4 py-2 border-none mobile:py-1 px-3 mobile:px-2 border-1.5 border-[#abc4ff40]",disabled:!w,value:h.amount,haveHalfButton:!0,haveCoinIcon:!0,topLeftLabel:"Asset",onUserInput:e=>p(t=>({...t,amount:e,perWeek:(0,z.$u)(e)&&(0,z.$u)(t.duration)?(0,H.Lu)((0,f.dC)((0,f.hi)(e,t.duration),7).toFixed(v)):""})),token:null==i?void 0:i.rewardToken})}),(0,a.jsxs)(P.Z,{className:"gap-4 mb-4",children:[(0,a.jsx)(B.Z,{className:"flex-[3] mobile:w-full rounded-md px-4",label:"Farming Starts",inputProps:{placeholder:"Select date and time",inputClassName:"text-sm font-medium text-white placeholder:text-[#abc4ff50]"},showTime:{format:"Select time: HH:mm UTC"},value:w?h.openTime:(0,L._3)(null==i?void 0:i.endTime),disabled:!w,disableDateBeforeCurrent:!0,isValidDate:e=>(0,W.Sl)(e,(0,L.mb)(b,{seconds:-86400}))&&(0,W.hF)(e,(0,L.mb)(h.openTime,{seconds:7776e3})),onDateChange:e=>{e&&p(t=>({...t,openTime:e,endTime:h.duration?(0,L.mb)(e,{milliseconds:function(e,t){let n=e.trim(),a=isFinite(Number(n))?Number(n):void 0,l="days"===t?a:void 0,s="hours"===t?a:void 0;return(null!=l?l:0)*864e5+(null!=s?s:0)*36e5}(h.duration,"days")}):void 0}))}}),(0,a.jsx)(O.Z,{label:"Duration",className:"flex-[2]",inputHTMLProps:{min:1,maxLength:3,step:1},pattern:/^\d{0,5}$/,placeholder:"7-90",suffix:(0,a.jsx)("span",{className:"text-[#abc4ff80] text-xs",children:"days"}),value:h.duration,onUserInput:e=>p(t=>({...t,duration:e}))})]}),(0,a.jsxs)(P.Z,{className:"gap-4 mb-4",children:[(0,a.jsx)(B.Z,{className:"shrink-0 flex-[3] mobile:w-full rounded-md px-4",label:"Farming Ends",inputProps:{placeholder:r?void 0:"Select date and time",inputClassName:"text-sm font-medium text-white placeholder:text-[#abc4ff50]"},value:h.endTime,disabled:w,disableDateBeforeCurrent:!0,showTime:!1,isValidDate:e=>{let t=(0,W.Sl)(e,(0,L.mb)(h.openTime,{seconds:604800}))&&(0,W.Sl)(e,b)&&(0,W.hF)(e,(0,L.mb)(h.openTime,{seconds:7776e3}));return t},onDateChange:e=>{e&&!w&&p(t=>({...t,duration:(0,f.hi)((0,f.lu)(e.valueOf(),t.openTime.valueOf()),864e5).toFixed(0),endTime:e}))}}),(0,a.jsx)(O.Z,{label:"Estimated rewards / week",className:"flex-[2]",onUserInput:e=>{p(t=>({...t,perWeek:e,amount:w?(0,z.$u)(e)&&(0,z.$u)(t.duration)?(0,f.dC)((0,f.hi)(e,7),t.duration).toFixed(v):"0":t.amount}))},value:h.perWeek})]}),(0,a.jsxs)(P.Z,{className:"justify-between items-center mb-6 mobile:mb-2",children:[(0,a.jsx)(C.Z,{className:"frosted-glass-teal min-w-[120px]",validators:[{should:x,forceActive:!0,fallbackProps:{onClick:()=>m.ZP.setState({isWalletSelectorShown:!0}),children:"Connect wallet"}},{should:(0,z.$u)(h.amount),fallbackProps:{children:"Enter ".concat(null==i?void 0:null===(t=i.rewardToken)||void 0===t?void 0:t.symbol," token amount")}},{should:(0,z.eg)(h.duration,7)&&(0,z.G)(h.duration,90),fallbackProps:{children:"Insufficient duration"}},{should:h.openTime&&h.endTime,fallbackProps:{children:"Confirm emission time setup"}},{should:j,fallbackProps:{children:"Insufficient ".concat(null==i?void 0:null===(n=i.rewardToken)||void 0===n?void 0:n.symbol," balance")}},{should:h.openTime&&(0,W.hF)(b,h.openTime),fallbackProps:{children:"Insufficient start time"}}],onClick:()=>{var e;c({rewardMint:(null==i?void 0:null===(e=i.rewardToken)||void 0===e?void 0:e.mint.toBase58())||"",data:{openTime:h.openTime.valueOf(),endTime:h.endTime.valueOf(),perSecond:(0,ea.Z)((0,f.hi)((0,f.dC)((0,f.hi)(h.perWeek,7),10**v),86400))}}),l()},children:"Save"}),(0,a.jsx)(C.Z,{type:"text",className:"text-sm text-[#ABC4FF] frosted-glass-skygray min-w-[120px]",onClick:l,children:"Cancel"})]})]})}})})}var es=n(1758),ei=n(95865);let er={DURATION:"Time extended must be a minimum 7 days and maximum 90 days.",DECREASE_ERROR:"Decreasing reward rate is permitted within 72 hrs of current farm end time. Try adding more tokens.",DECREASE:"Decreasing the reward rate is permitted within 72 hours of current farm end time."};function eo(e){var t;let{defaultData:n,reward:s,chainTimeOffset:i,onClose:r,onConfirm:o}=e,c=(0,m.ZP)(e=>e.isMobile),u=(0,d.ZP)(e=>e.tokenPrices),[x,h]=(0,l.useState)(!!n),p=Date.now()+(null!=i?i:0),[v,b]=(0,g.Z)(e=>[e.getBalance,e.connected]),[w,j]=(0,l.useState)({amount:"",daysExtend:""}),{endTime:k,rewardToken:N,perSecond:y,apr:Z,rewardPerWeek:T,tvl:R}=s||{},E=!!(w.amount&&w.daysExtend),A=!!(N&&(0,z.eg)(v(N),w.amount)),F=null!==(t=null==N?void 0:N.decimals)&&void 0!==t?t:6,B=(0,l.useMemo)(()=>Math.floor(((k||0)-p)/1e3),[s]),W=Math.ceil(B/86400),U=(0,f.dC)((0,f.hi)((null==y?void 0:y.toFixed(F))||0,10**F),B),H=(0,f.hi)(w.amount||0,(0,f.dC)(w.daysExtend||0,86400)),$=(0,f.hi)((0,f.PD)(U,w.amount||0),(0,f.PD)(B,(0,f.dC)(w.daysExtend||0,86400))),_=(0,z.lt)(H,$)?H:$,q=(0,f.dC)(_,604800),G=!!s&&(0,z.lt)(_.toFixed(F),(0,f.hi)(y||0,10**F).toFixed(F)),K=(0,z.$u)(w.daysExtend)&&(0,z.eg)(w.daysExtend,7)&&(0,z.G)(w.daysExtend,90),Y="";return x&&!K?Y=er.DURATION:G&&(Y=B>=0&&B<=259200?er.DECREASE:er.DECREASE_ERROR),(0,l.useEffect)(()=>{if(!n)return;let{amount:e="",daysExtend:t=""}=n||{};return j({amount:e,daysExtend:t}),()=>j({amount:"",daysExtend:""})},[n]),(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(en.Z,{placement:"from-bottom",open:!!s,onClose:r,children:e=>{var t,n;let{close:l}=e;return(0,a.jsxs)(D.Z,{className:"p-8 mobile:p-4 rounded-3xl mobile:rounded-lg w-[min(698px,90vw)] max-h-[80vh] mobile:w-full border-1.5 border-[rgba(171,196,255,0.2)] bg-cyberpunk-card-bg shadow-cyberpunk-card",size:"lg",children:[(0,a.jsxs)(P.Z,{className:"justify-between items-center mb-6 mobile:mb-2",children:[(0,a.jsx)("div",{className:"mobile:text-base text-xl font-semibold text-white",children:"Adjust rewards"}),(0,a.jsx)(S.Z,{heroIconName:"x",className:"cursor-pointer",onClick:r})]}),(0,a.jsxs)("div",{className:"max-h-[calc(80vh-200px)] pr-2 overflow-y-auto overflow-x-hidden",children:[(0,a.jsxs)("div",{className:"bg-[rgba(171,196,255,0.08)] text-secondary-title text-sm p-3 mb-5 rounded-xl",children:[(0,a.jsx)("span",{className:"text-style-color-fuchsia",children:"Please note:"})," You can add more tokens and/or extend the farming period. Any action that will decrease the reward rate can only be done within 72 hours of current farm end time, and the period must be extended by at least 7 days."]}),(0,a.jsx)("div",{className:"text-secondary-title text-sm mb-3",children:"Current rewards period"}),(0,a.jsx)(J.Z,{list:s?[s]:[],type:c?"item-card":"list-table",className:c?"gap-4":"",getItemKey:e=>"".concat(e.tokenMint.toBase58(),"-").concat(e.creator.toBase58()),labelMapper:[{label:"Remaining amount",cssGridItemWidth:".7fr"},{label:"Farming ends"},{label:"Rate",cssGridItemWidth:"1fr"}],renderRowItem:e=>{let{label:t}=e;return"Remaining amount"===t?(0,a.jsx)(M.Z,{className:"gap-4 h-full",children:y?(0,a.jsxs)(V.Z,{className:"grow gap-2 break-all justify-center text-xs",children:[(0,a.jsx)("div",{className:"text-white text-base",children:(0,X.Z)(U,{fractionLength:F})}),(0,a.jsx)("div",{children:(0,ei.Z)((0,es.Z)((0,f.dC)((0,f.hi)(y.toFixed(F),10**F),B),u[String(null==N?void 0:N.mint)]))})]}):void 0}):"Farming ends"===t?(0,a.jsx)(M.Z,{className:"h-full",children:k?(0,a.jsxs)(V.Z,{className:"justify-center gap-2 text-xs",children:[(0,a.jsx)("span",{className:"text-white text-base",children:(0,L.xn)(k)}),(0,a.jsxs)("span",{children:[W,"D remaining"]})]}):void 0}):"Rate"===t?(0,a.jsx)(M.Z,{className:"gap-4 h-full",children:(0,a.jsxs)(V.Z,{className:"grow justify-center text-xs gap-2",children:[(0,a.jsxs)("div",{className:" text-base",children:[(0,a.jsxs)("span",{className:"text-white",children:[(0,X.Z)(T),"\xa0"]}),null==N?void 0:N.symbol,"/week"]}),Z," APR"]})}):void 0}}),(0,a.jsxs)("div",{className:"flex items-center text-secondary-title text-sm mt-5 mb-3",children:["Additional rewards adjustment",(0,a.jsxs)(I.Z,{children:[(0,a.jsx)(S.Z,{iconClassName:"ml-1",size:"sm",heroIconName:"question-mark-circle"}),(0,a.jsx)(I.Z.Panel,{children:(0,a.jsx)("div",{className:"max-w-[300px]",children:"Rewards entered below are in addition to rewards remaining in the current rewards period above. Additional rewards will be deposited in the farm from your wallet balance and combined with existing remaining rewards."})})]})]}),(0,a.jsxs)(P.Z,{className:"gap-4 mb-4",children:[(0,a.jsx)(et.Z,{className:"py-2 flex-[2] border-none mobile:py-1 px-3 mobile:px-2 border-1.5 border-[#abc4ff40]",value:w.amount,haveHalfButton:!0,haveCoinIcon:!0,topLeftLabel:"Asset",onUserInput:e=>{j(t=>({...t,amount:e})),h(!0)},token:null==s?void 0:s.rewardToken}),(0,a.jsx)(O.Z,{label:"Days Extended",className:"flex-[1] max-h-[88px]",inputHTMLProps:{min:1,maxLength:3,step:1},pattern:/^\d{0,5}$/,placeholder:"7-90",suffix:(0,a.jsx)("span",{className:"text-[#abc4ff80] text-xs",children:"Days"}),value:w.daysExtend,onUserInput:e=>{j(t=>({...t,daysExtend:e})),h(!0)}})]}),Y&&(0,a.jsx)("div",{className:"text-style-color-fuchsia mb-4",children:Y}),E&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center text-secondary-title text-sm mb-3",children:["Updated rewards period",(0,a.jsxs)(I.Z,{children:[(0,a.jsx)(S.Z,{iconClassName:"ml-1",size:"sm",heroIconName:"question-mark-circle"}),(0,a.jsx)(I.Z.Panel,{children:(0,a.jsx)("div",{className:"max-w-[300px]",children:"Updated rewards combines remaining current rewards and additional rewards entered above. Calculations are for the adjusted farming period time and rewards rate."})})]})]}),(0,a.jsx)(J.Z,{list:s&&w.amount&&w.daysExtend?[s]:[],type:c?"item-card":"list-table",className:c?"gap-4":"",getItemKey:e=>"".concat(e.tokenMint.toBase58(),"-").concat(e.creator.toBase58()),labelMapper:[{label:"Total amount",cssGridItemWidth:".7fr"},{label:"Farming ends"},{label:"Rate",cssGridItemWidth:"1fr"}],renderRowItem:e=>{let{label:t}=e,n=w.amount||w.daysExtend?(0,Q.Z)((0,f.hi)((0,f.dC)((0,f.dC)(_,31536e3),N?u[N.mint.toBase58()]:0),R)):Z;return"Total amount"===t?(0,a.jsx)(M.Z,{className:"gap-4 h-full",children:y?(0,a.jsxs)(V.Z,{className:"grow gap-2 break-all justify-center text-xs",children:[(0,a.jsx)("div",{className:"text-white text-base",children:(0,X.Z)(G?(0,f.PD)(w.amount,(0,f.dC)(_,B)).toFixed(F):(0,f.PD)(w.amount,U).toFixed(F),{fractionLength:F})}),(0,a.jsx)("div",{children:(0,ei.Z)((0,es.Z)((0,f.PD)(w.amount,U).toFixed(F),u[String(null==N?void 0:N.mint)]))})]}):void 0}):"Farming ends"===t?(0,a.jsx)(M.Z,{className:"h-full",children:k?(0,a.jsxs)(V.Z,{className:"justify-center gap-2 text-xs",children:[(0,a.jsx)("span",{className:"text-white text-base",children:(0,L.xn)((0,L.mb)(k,{days:Number(w.daysExtend||"0")}))}),(0,a.jsxs)("span",{children:[W+Number(w.daysExtend||"0"),"D in Total"]})]}):void 0}):"Rate"===t?(0,a.jsx)(M.Z,{className:"gap-4 h-full",children:(0,a.jsxs)(V.Z,{className:"grow justify-center text-xs gap-2",children:[(0,a.jsxs)("div",{className:" text-base",children:[(0,a.jsxs)("span",{className:"text-white",children:[(0,X.Z)(q),"\xa0"]}),null==N?void 0:N.symbol,"/week"]}),n," APR"]})}):void 0}})]})]}),(0,a.jsxs)(P.Z,{className:"justify-between items-center mt-10 mobile:mb-2",children:[(0,a.jsx)(C.Z,{className:"frosted-glass-teal min-w-[120px]",validators:[{should:b,forceActive:!0,fallbackProps:{onClick:()=>m.ZP.setState({isWalletSelectorShown:!0}),children:"Connect wallet"}},{should:(0,z.$u)(w.amount),fallbackProps:{children:"Enter ".concat(null==s?void 0:null===(t=s.rewardToken)||void 0===t?void 0:t.symbol," token amount")}},{should:K,fallbackProps:{children:"Insufficient days extended"}},{should:Y!==er.DECREASE_ERROR},{should:A,fallbackProps:{children:"Insufficient ".concat(null==s?void 0:null===(n=s.rewardToken)||void 0===n?void 0:n.symbol," balance")}}],onClick:()=>{var e;o({rewardMint:(null==s?void 0:null===(e=s.rewardToken)||void 0===e?void 0:e.mint.toBase58())||"",data:{...w,openTime:p,endTime:(0,L.mb)(k,{days:Number(w.daysExtend)}).valueOf(),perSecond:(0,f.dC)(_,10**F)}}),l()},children:"Save"}),(0,a.jsx)(C.Z,{type:"text",className:"text-sm text-[#ABC4FF] frosted-glass-skygray min-w-[120px]",onClick:l,children:"Cancel"})]})]})}})})}function ed(e){let{pool:t,onUpdateReward:n,previewMode:s}=e,[i,c]=(0,m.ZP)(e=>[e.isMobile,e.isApprovePanelShown]),u=(0,o.ZP)(e=>e.chainTimeOffset),x=(0,d.ZP)(e=>e.tokenPrices),[h,p]=(0,l.useState)(),[v,b]=(0,l.useState)(),[w,j]=(0,l.useState)(new Map),g=Date.now()+(null!=u?u:0),k=(0,l.useCallback)(()=>p(void 0),[]),N=(0,l.useCallback)(()=>b(void 0),[]),Z=(0,l.useCallback)(e=>{let{rewardMint:t,data:n}=e;j(e=>(e.set(t,n),new Map(Array.from(e))))},[]),T=(0,l.useCallback)(e=>{j(t=>(t.delete(e),new Map(Array.from(t))))},[]);return(0,l.useEffect)(()=>{n(w)},[w,n]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(J.Z,{list:t.rewardInfos,type:i?"item-card":"list-table",className:i?"gap-4":"",getItemKey:e=>"".concat(e.tokenMint.toBase58(),"-").concat(e.creator.toBase58()),labelMapper:[{label:"Asset",cssGridItemWidth:".7fr"},{label:"Amount"},{label:"Duration",cssGridItemWidth:"1fr"},{label:"Period",cssGridItemWidth:"1.5fr"},{label:"Rate"}],renderRowItem:e=>{var n,l,s,i;let{item:r,label:o,index:d}=e,{openTime:c,endTime:m,rewardToken:u,perSecond:h,rewardPerWeek:p}=r,v=!!(c&&(0,W.hF)(g,c)),b=!!(m&&(0,W.Sl)(g,m)),j=(0,U.g9)(m,c);function k(e){let t=(0,U.ZP)(e);return t.hours?"".concat(t.days,"D ").concat(t.hours,"H"):"".concat(t.days,"D")}let N=null!==(n=null==u?void 0:u.decimals)&&void 0!==n?n:6,Z=w.get(r.rewardToken.mint.toBase58()),T=Z?(0,U.g9)(Z.endTime,Z.openTime):0,C=!b&&!!Z;if("Asset"===o)return r.rewardToken?(0,a.jsx)(V.Z,{className:"h-full gap-1 justify-center",children:(0,a.jsxs)(P.Z,{className:"gap-1 items-center",children:[(0,a.jsx)(K.Z,{token:r.rewardToken,size:"sm"}),(0,a.jsx)("div",{children:null!==(l=r.rewardToken.symbol)&&void 0!==l?l:"UNKNOWN"})]})}):"--";if("Amount"===o){let e=Z&&u&&(0,y.n)(u,(0,f.dC)(Z.perSecond,Math.floor(T/1e3))),t=e&&(0,Y.w)({amount:e});return(0,a.jsxs)(M.Z,{className:"gap-4 h-full",children:[!C&&h?(0,a.jsx)(V.Z,{className:"grow break-all justify-center",children:(0,X.Z)((0,f.dC)((0,f.hi)(h.toFixed(N),10**N),Math.floor(j/1e3)),{fractionLength:N})}):void 0,Z&&(0,a.jsxs)(V.Z,{className:"grow justify-center text-[#39d0d8]",children:[(0,$.B)(e)," ",(0,a.jsx)(ee.j,{promise:t,fallback:"(loading)",children:e=>(null==e?void 0:e.fee)?"(including fee: ".concat((0,$.B)(e.fee),")"):""})]})]})}if("Duration"===o)return(0,a.jsxs)(M.Z,{className:"h-full gap-3",children:[!C&&c&&m?(0,a.jsx)(V.Z,{className:"justify-center",children:(0,a.jsxs)(P.Z,{className:"break-all items-center gap-1",children:[k(j),b?(0,a.jsx)(G.C,{className:"w-fit",cssColor:"#da2Eef",children:"Ended"}):v?(0,a.jsx)(G.C,{className:"w-fit",cssColor:"#abc4ff",children:"Upcoming"}):(c||m)&&(b||v)?null:(0,a.jsx)(G.C,{className:"w-fit",cssColor:"#39d0d8",children:"Ongoing"})]})}):void 0,Z&&(0,a.jsx)(V.Z,{className:"grow justify-center text-[#39d0d8]",children:(0,a.jsxs)(P.Z,{className:"break-all items-center gap-1",children:[k(T),(0,a.jsx)(G.C,{cssColor:"#39d0d8",children:C?"Updated":"New"})]})})]});if("Period"===o){if(!c||!m)return;return(0,a.jsxs)(M.Z,{className:"gap-4 h-full",children:[!C&&(0,a.jsxs)(V.Z,{className:"grow justify-center",children:[(0,a.jsx)("div",{children:(0,L.xn)(c)}),(0,a.jsx)("div",{children:(0,L.xn)(m)})]}),Z&&(0,a.jsxs)(V.Z,{className:"grow justify-center text-[#39d0d8]",children:[(0,a.jsx)("div",{children:(0,L.xn)(Z.openTime)}),(0,a.jsx)("div",{children:(0,L.xn)(Z.endTime)})]})]})}if("Rate"===o)return(0,a.jsxs)(M.Z,{className:"gap-4 h-full",children:[!C&&(0,a.jsxs)(V.Z,{className:"grow justify-center text-xs",children:[(0,a.jsxs)("div",{children:[(0,X.Z)(p),"/week"]}),t.rewardApr24h[d]&&(0,a.jsxs)("div",{children:[(0,Q.Z)(t.rewardApr24h[d])," APR"]})]}),Z&&(0,a.jsxs)(V.Z,{className:"grow justify-center text-[#39d0d8]",children:[(0,a.jsxs)("div",{children:[(0,X.Z)((0,f.dC)((0,f.hi)(Z.perSecond,10**N),604800),{fractionLength:null!==(i=null===(s=r.rewardToken)||void 0===s?void 0:s.decimals)&&void 0!==i?i:6}),"/week"]}),(0,a.jsxs)("div",{children:[(0,Q.Z)((0,f.hi)((0,f.dC)((0,f.dC)((0,f.hi)(Z.perSecond,10**N),31536e3),x[r.tokenMint.toBase58()]||0),t.tvl))," ","APR"]})]})]})},renderItemActionButtons:e=>{let{itemData:n,index:l}=e,i=(0,z.gt)(n.remainingRewards,0),{endTime:o}=n,d=!!(o&&(0,W.Sl)(g,o)),m=o-g<=2592e5&&!w.get(n.rewardToken.mint.toBase58())&&!s,u=n.remainingRewards&&n.rewardToken&&(0,Y.w)({amount:(0,y.n)(n.rewardToken,n.remainingRewards)});if(!d&&!s)return(0,a.jsx)("div",{className:"flex bg-[#abc4ff1a] mobile:bg-transparent items-center rounded-md p-2 mobile:p-0 mb-4 mobile:mb-0 empty:hidden ".concat(m?"":"opacity-50 cursor-not-allowed"),children:(0,a.jsxs)(C.Z,{disabled:!m,onClick:()=>b({...n,apr:(0,Q.Z)(t.rewardApr24h[l]),tvl:t.tvl}),noComponentCss:!0,className:"flex flex-1 justify-center items-center text-secondary-title text-xs font-medium clickable mobile:py-4",children:[(0,a.jsx)(S.Z,{className:"mr-1",heroIconName:"pencil",size:"xs"}),"Adjust rewards"]})});if(m){var x;let e=n.rewardToken&&(0,y.n)(n.rewardToken,n.remainingRewards?(0,f.kg)(n.remainingRewards,0):n.remainingRewards);return(0,a.jsxs)("div",{className:"flex bg-[#abc4ff1a] mobile:bg-transparent items-center rounded-md p-2 mobile:p-0 mb-4 mobile:mb-0 empty:hidden",children:[(0,a.jsxs)(C.Z,{onClick:()=>p({...n,isRewardEnded:d}),noComponentCss:!0,className:"flex flex-1 justify-center text-secondary-title text-xs font-medium clickable mobile:py-4",children:[(0,a.jsx)(S.Z,{heroIconName:"plus",size:"sm"}),"Add more rewards"]}),(0,a.jsxs)(C.Z,{noComponentCss:!0,disabled:!i||c,onClick:()=>{e&&n.rewardToken&&q({currentAmmPool:t,rewardInfo:n,claimableAmount:e}).then(e=>{e&&r.ZP.getState().refreshConcentrated()})},className:"flex flex-1 gap-1 justify-center items-center text-secondary-title text-xs font-medium ".concat(i&&!c?"clickable":"cursor-default opacity-50"," mobile:py-4"),children:[(0,a.jsx)(S.Z,{iconSrc:"/icons/create-farm-roll-back.svg",size:"xs",className:"text-[#abc4ff80]"}),(0,a.jsxs)(V.Z,{className:"items-start",children:["Claim unemmitted rewards",(0,a.jsxs)(P.Z,{className:"text-[#abc4ff80] gap-1",children:[(0,a.jsxs)("span",{children:[(0,$.B)(e)," "]}),null===(x=n.rewardToken)||void 0===x?void 0:x.symbol,(0,a.jsx)("div",{className:"whitespace-nowrap",children:(0,a.jsx)(ee.j,{promise:u,fallback:"(loading)",children:e=>(null==e?void 0:e.fee)?"(include ".concat((0,$.B)(e.fee)," fee)"):void 0})})]})]})]})]})}return null},renderControlButtons:e=>{let{itemData:t}=e,n=!!(t.endTime&&(0,W.Sl)(g,t.endTime)),l=w.get(t.rewardToken.mint.toBase58());return w.get(t.rewardToken.mint.toBase58())?(0,a.jsx)(G.C,{className:"cursor-pointer",cssColor:s?"#39d0d8":"#abc4ff",onClick:s?void 0:()=>T(t.rewardToken.mint.toBase58()),children:s?!n&&l?"Updated":"Added":"reset"}):null}}),(0,a.jsx)(el,{open:!!h,reward:h,chainTimeOffset:u,onClose:k,onConfirm:Z}),(0,a.jsx)(eo,{defaultData:v?w.get(v.rewardToken.mint.toBase58()):void 0,reward:v,chainTimeOffset:u,onClose:N,onConfirm:Z})]})}function ec(e){let{newRewards:t,tvl:n,onClickRow:l,onDelete:s}=e,i=(0,m.ZP)(e=>e.isMobile),r=(0,d.ZP)(e=>e.tokenPrices);return(0,a.jsx)(J.Z,{list:t,type:i?"item-card":"list-table",className:i?"gap-4 mb-8":"mb-8",getItemKey:()=>Date.now(),labelMapper:[{label:"Asset",cssGridItemWidth:".7fr"},{label:"Amount"},{label:"Duration",cssGridItemWidth:"1fr"},{label:"Period",cssGridItemWidth:"1.5fr"},{label:"Rate"}],rowClassName:()=>l?"clickable hover:backdrop-brightness-95":"",onClickRow:e=>{let{index:t}=e;return null==l?void 0:l(t)},renderRowItem:e=>{var t,l,s,i;let{item:o,label:d}=e,{openTime:c,endTime:m,perWeek:u,token:x,amount:h}=o,p=(0,f.hi)(u,7),v=(0,U.g9)(m||0,c||0),b=(0,z.$u)(p);if("Asset"===d)return o.token?(0,a.jsx)(V.Z,{className:"h-full gap-1 justify-center",children:(0,a.jsxs)(P.Z,{className:"gap-1 items-center",children:[(0,a.jsx)(K.Z,{token:o.token,size:"sm"}),(0,a.jsx)("div",{children:null!==(t=o.token.symbol)&&void 0!==t?t:"UNKNOWN"})]})}):"--";if("Amount"===d)return(0,z.$u)(v)?(0,a.jsx)(M.Z,{className:"gap-4 h-full",children:b?(0,a.jsxs)(V.Z,{className:"grow break-all justify-center",children:[(0,a.jsx)("div",{children:(0,X.Z)(null==h?void 0:h.total,{fractionLength:null!==(l=null==x?void 0:x.decimals)&&void 0!==l?l:6})}),(0,z.$u)(null==h?void 0:h.fee)&&(0,a.jsxs)(P.Z,{className:"text-2xs text-[#abc4ff80] gap-1 items-center",children:[(0,a.jsx)("span",{children:"Includes Fee:"}),(0,a.jsx)("span",{children:(0,X.Z)(null==h?void 0:h.fee,{fractionLength:null!==(s=null==x?void 0:x.decimals)&&void 0!==s?s:6})})]})]}):void 0}):null;if("Duration"===d)return(0,a.jsx)(M.Z,{className:"h-full gap-3",children:c&&m?(0,a.jsx)(V.Z,{className:"justify-center",children:(0,a.jsx)(P.Z,{className:"break-all items-center gap-1",children:function(e){let t=(0,U.ZP)(e);return t.hours?"".concat(t.days,"D ").concat(t.hours,"H"):"".concat(t.days,"D")}(v)})}):void 0});if("Period"===d){if(!c||!m)return;return(0,a.jsx)(M.Z,{className:"gap-4 h-full",children:(0,a.jsxs)(V.Z,{className:"grow justify-center",children:[(0,a.jsx)("div",{children:(0,L.xn)(c)}),(0,a.jsx)("div",{children:(0,L.xn)(m)})]})})}if("Rate"===d)return b?(0,a.jsx)(M.Z,{className:"gap-4 h-full",children:(0,a.jsxs)(V.Z,{className:"grow justify-center text-xs",children:[(0,a.jsxs)("div",{children:[(0,X.Z)(u,{fractionLength:null!==(i=null==x?void 0:x.decimals)&&void 0!==i?i:6}),"/week"]}),(0,a.jsxs)("div",{children:[(0,Q.Z)((0,f.hi)((0,f.dC)((0,f.dC)(p,x?r[x.mint.toBase58()]:0),365),n||0))," ","APR"]})]})}):null},renderControlButtons:e=>{let{index:t}=e;return s?(0,a.jsx)(S.Z,{className:"cursor-pointer",heroIconName:"trash",size:"sm",onClick:()=>s(t)}):null}})}var em=n(54531),eu=n(99522);function ex(e){let{pool:t}=e,n=(0,m.ZP)(e=>e.isMobile);return(0,a.jsx)(J.Z,{className:"mb-8",type:n?"item-card":"list-table",itemClassName:n?"grid-cols-[1fr,2fr]":void 0,list:t?[{id:t.idString,pool:t}]:[],getItemKey:e=>e.id,labelMapper:[{label:"Pool",cssGridItemWidth:"2fr"},{label:"TVL"},{label:"APR",renderLabel:()=>(0,a.jsx)(P.Z,{children:(0,a.jsx)("div",{children:"APR"})})}],renderRowItem:e=>{let{item:t,label:n}=e;if("Pool"===n){var l,s,i,r;return t.id?(0,a.jsxs)(P.Z,{className:"gap-1 items-center",children:[(0,a.jsx)(em.Z,{token1:t.pool.base,token2:t.pool.quote,size:"sm"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{children:[null!==(i=null===(l=t.pool.base)||void 0===l?void 0:l.symbol)&&void 0!==i?i:"UNKNOWN","-",null!==(r=null===(s=t.pool.quote)||void 0===s?void 0:s.symbol)&&void 0!==r?r:"UNKNOWN"]}),(0,a.jsx)(eu.U,{showDigitCount:8,textClassName:"text-[#abc4ff80] text-xs",canCopy:!1,children:t.pool.idString})]})]}):"--"}return"TVL"===n?(0,a.jsx)(V.Z,{className:"justify-center h-full",children:t.pool.tvl?(0,ei.Z)(t.pool.tvl,{decimalPlace:0}):"--"}):"APR"===n?(0,a.jsx)(V.Z,{className:"justify-center h-full",children:t.pool.totalApr30d?(0,Q.Z)(t.pool.totalApr30d):"--"}):void 0}})}function eh(){var e,t;let n=(0,m.ZP)(e=>e.isMobile),s=(0,g.Z)(e=>e.connected),o=(0,d.ZP)(e=>e.getToken),c=(0,d.ZP)(e=>e.sortTokensWithBalance),[u,x]=(0,r.ZP)(e=>[e.currentAmmPool,e.whitelistRewards],i.X),f=(0,g.Z)(e=>e.owner),[p,v]=(0,l.useState)({newRewards:[]}),[b,w]=(0,l.useState)(!1),[j,k]=(0,l.useState)(!1),[N,y]=(0,l.useState)([]),[D,F]=(0,l.useState)(-1),[B,M]=(0,l.useState)(2-((null==u?void 0:u.rewardInfos.length)||0)),O=u&&(null==u?void 0:u.rewardInfos.length)>0,L=((null==u?void 0:u.rewardInfos)||[]).length>0||p.newRewards.filter(e=>!!(null==e?void 0:e.token)).length>0,W=(0,l.useMemo)(()=>{var e,t;return new Set([...x.map(e=>e.toBase58()),null==u?void 0:null===(e=u.base)||void 0===e?void 0:e.mint.toBase58(),null==u?void 0:null===(t=u.quote)||void 0===t?void 0:t.mint.toBase58()])},[x,u]),U=(0,l.useMemo)(()=>(null==u?void 0:u.rewardInfos.some(e=>W.has(e.tokenMint.toBase58())))||p.newRewards.some(e=>{var t;return W.has(null===(t=e.token)||void 0===t?void 0:t.mint.toBase58())}),[u,p,W]),z=L&&(!U&&0===B||(null===(e=p.newRewards[D])||void 0===e?void 0:e.isWhiteListReward))?c((0,E.Do)(Array.from(W).map(e=>o(e)).filter(e=>!u||e&&!u.rewardInfos.some(t=>t.tokenMint.equals(e.mint))).filter(e=>!p.newRewards.some(t=>{var n;return null===(n=t.token)||void 0===n?void 0:n.mint.equals(e.mint)}))),!0):void 0,H=N.findIndex(e=>!!e),$=B>0&&-1===H,q=!j&&!!u&&u.rewardInfos.length<=1;(0,l.useEffect)(()=>{u&&M(2-(u.rewardInfos.length||0)-p.newRewards.length)},[null==u?void 0:u.rewardInfos.length,p.newRewards.length]);let G=(0,l.useCallback)((e,t)=>{y(n=>{let a=[...n];return a[e]=t,a})},[]),K=(0,l.useCallback)(()=>{w(!1),k(!0)},[]),V=(0,l.useCallback)(e=>{v(t=>({...t,updateReward:e}))},[]),J=(0,l.useCallback)((e,t)=>{v(n=>{let a=[...n.newRewards];if(a[t]=e,a.filter(e=>!!(null==e?void 0:e.token)).length>1&&!a.find(e=>e.isWhiteListReward)){let e=a.findIndex(e=>{var t;return W.has(null===(t=e.token)||void 0===t?void 0:t.mint.toBase58())});e>-1&&(a[e].isWhiteListReward=!0)}return{...n,newRewards:a}})},[U,W]),X=(0,l.useCallback)(e=>F(e),[]),Q=(0,l.useCallback)(e=>{v(t=>{let n=[...t.newRewards];return n.splice(e,1),n.forEach(e=>e.isWhiteListReward=!1),F(n.length-1),{...t,newRewards:n}}),M(e=>e+1),y(t=>{let n=[...t];return n.splice(e,1),n})},[G]),Y=()=>{let{newRewards:e,updateReward:t}=p,n=Array.from(t||new Map).map(e=>{let[t,n]=e,a=null==u?void 0:u.rewardInfos.find(e=>(0,h.ZP)(e.tokenMint)===t);return a&&n.openTime<a.endTime?[t,{...n,openTime:a.endTime}]:(n.openTime<=Date.now()&&(n.openTime=Date.now()+3e4),[t,n])});Z({onTxSuccess:()=>w(!0),currentAmmPool:u,updateRewards:new Map(n),newRewards:e.length>0?e.map(e=>({token:e.token,openTime:e.openTime,endTime:e.endTime,perWeek:e.perWeek,amount:e.amount.total})):[]})},ee=(0,l.useCallback)(()=>F(e=>e+1),[]);return((0,l.useEffect)(()=>{u&&!u.rewardInfos.length&&-1===D&&ee()},[u,D,ee]),s&&f&&(0,A.aT)(null==u?void 0:u.creator,f))?(0,a.jsxs)("div",{className:"max-w-[720px]",children:[(0,a.jsxs)("div",{className:"text-2xl mb-4",children:[O?"Edit":"Create"," Farm"]}),(0,a.jsxs)("div",{className:"text-[#C4D6FF] text-sm mb-4",children:["Before creating a farm, make sure to check the",(0,a.jsx)(R.Z,{className:"ml-1",href:"https://docs.raydium.io/raydium/concentrated-liquidity/creating-a-clmm-pool-and-farm",children:"detailed guide"}),"."]}),(0,a.jsx)("div",{className:"text-sm text-secondary-title mb-3",children:"Concentrated liquidity Pool"}),(0,a.jsx)(ex,{pool:u}),(null==u?void 0:u.rewardInfos)&&u.rewardInfos.length>0?(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("div",{className:"text-sm text-secondary-title mb-3",children:"Existing Farming rewards"}),(0,a.jsx)(ed,{pool:u,previewMode:j,onUpdateReward:V})]}):null,(p.newRewards.length>1||j&&p.newRewards.length>0)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-sm text-secondary-title mb-3",children:"New farming rewards"}),(0,a.jsx)(ec,{tvl:null==u?void 0:u.tvl,newRewards:p.newRewards,onClickRow:j?void 0:X,onDelete:j?void 0:Q})]}),q&&(0,a.jsxs)(a.Fragment,{children:[-1!==D?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm text-secondary-title mb-3",children:["New farming rewards",(0,a.jsxs)(I.Z,{children:[(0,a.jsx)(S.Z,{size:"sm",heroIconName:"question-mark-circle"}),(0,a.jsx)(I.Z.Panel,{children:(0,a.jsxs)("div",{className:"max-w-[300px]",children:["Two reward tokens can be added to a farm. The first can be any SPL token. ",(0,a.jsx)("br",{}),"If two tokens are added, at least one should be from the token pair of the pool."]})})]})]}),(0,a.jsx)(_,{enableTokens:z,disableTokens:(0,E.Do)([...u?u.rewardInfos.map(e=>e.rewardToken):[],...p.newRewards.map(e=>e.token)]),dataIndex:D,defaultData:p.newRewards[D],onValidateChange:G,onUpdateReward:J},D)]}):null,(0,a.jsxs)(P.Z,{className:"items-center w-fit mb-2 ".concat($?"cursor-pointer":"opacity-50 cursor-default"),onClick:$?ee:void 0,children:[(0,a.jsx)(S.Z,{className:"text-[#abc4ff]",heroIconName:"plus-circle",size:"sm"}),(0,a.jsx)("div",{className:"ml-1.5 text-[#abc4ff] font-base mobile:text-sm",children:"Add reward token"}),(0,a.jsxs)("div",{className:"ml-1.5 text-[#abc4ff80] font-base mobile:text-sm",children:["(",B," more)"]})]})]}),b?(0,a.jsx)("div",{className:"mb-4 text-[#39d0d8] text-center text-sm",children:"Farming rewards successfully updated"}):null,!j&&(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)(C.Z,{className:"frosted-glass-teal mt-12 w-auto",onClick:K,validators:[{should:s,forceActive:!0,fallbackProps:{onClick:()=>m.ZP.setState({isWalletSelectorShown:!0}),children:"Connect wallet"}},{should:(null===(t=p.updateReward)||void 0===t?void 0:t.size)||p.newRewards.length>0},{should:-1===H,fallbackProps:{children:N[H]}}],children:"Review Changes"})}),j&&(0,a.jsxs)(P.Z,{className:"justify-center gap-2",children:[b?(0,a.jsx)(C.Z,{className:"frosted-glass-skygray w-fit",size:n?"sm":"lg",onClick:()=>(0,T.Eh)("/clmm/pools"),children:"Back to Pools"}):(0,a.jsx)(C.Z,{className:"frosted-glass-teal w-fit",onClick:Y,children:"Confirm Farm Changes"}),(0,a.jsx)(C.Z,{className:"frosted-glass-skygray w-fit",size:n?"sm":"lg",onClick:()=>{if(b){window.location.reload();return}k(!1),w(!1)},children:"Edit"})]}),!j&&(0,a.jsxs)("div",{className:"flex mt-12",children:[(0,a.jsx)(S.Z,{className:"text-[#abc4ff] mr-[15px]",heroIconName:"exclamation-circle",size:"md"}),(0,a.jsxs)("div",{className:"p-6 bg-[#1B1659] rounded-[20px] border-1.5 border-[rgba(171,196,255,0.2)] text-left text-sm text-[rgba(196,214,255,0.5)]",children:[(0,a.jsx)("div",{className:"text-[#ABC4FF] font-medium font-base mobile:text-sm",children:"How to adjust existing rewards?"}),(0,a.jsxs)("div",{className:"flex mt-2",children:[(0,a.jsx)("span",{className:"mr-1",children:"1."}),"Rewards allocated to farms ",(0,a.jsx)("span",{className:"px-1 underline",children:"cannot be withdrawn"})," after farming starts."]}),(0,a.jsxs)("div",{className:"flex mt-2",children:[(0,a.jsx)("span",{className:"mr-1",children:"2."}),"If you want to increase the reward rate, additional rewards can be added while a farm is still running. The period must be extended by at least 7 days."]}),(0,a.jsxs)("div",{className:"flex mt-2",children:[(0,a.jsx)("span",{className:"mr-1",children:"3."}),"If you want to decrease the rewards rate, this can only be done 72 hours before the end of the current farming period, and the period must be extended by at least 7 days."]})]})]})]}):s?(0,a.jsx)("div",{className:"max-w-[720px]",children:(0,a.jsxs)("div",{className:"text-xl mb-10 text-secondary-title",children:["Opps! Only pool's creator can ",O?"Edit":"Create"," rewards"]})}):(0,a.jsxs)("div",{className:"max-w-[720px]",children:[(0,a.jsxs)("div",{className:"text-xl mb-10 text-secondary-title",children:["You must connect your wallet before you can ",O?"Edit":"Create"," Farm"]}),(0,a.jsx)(C.Z,{className:"w-full frosted-glass-teal mt-5",onClick:()=>m.ZP.setState({isWalletSelectorShown:!0}),children:"Connect Wallet"})]})}var ef=n(66180);function ep(){return(0,a.jsx)(P.Z,{className:(0,ef.m)("-mt-4 mobile:mt-0.5 mb-8 mobile:mb-2 sticky z-10 -top-4 mobile:top-0 mobile:-translate-y-2 mobile:bg-[#0f0b2f] mobile:hidden items-center justify-between"),children:(0,a.jsx)(C.Z,{type:"text",className:"text-sm text-[#ABC4FF] opacity-50 px-0",prefix:(0,a.jsx)(S.Z,{heroIconName:"chevron-left",size:"sm"}),onClick:()=>(0,T.Eh)("/clmm/pools"),children:"Back to Concentrated Pools"})})}function ev(){let e=(0,o.ZP)(e=>e.connection),t=(0,d.ZP)(e=>e.getToken),[n,m]=(0,r.ZP)(e=>[e.hydratedAmmPools,e.fetchWhitelistRewards],i.X),{query:u}=(0,s.useRouter)(),x=null==u?void 0:u.farmId;return(0,l.useEffect)(()=>{if(!x)return;let e=n.find(e=>e.idString===x);e&&r.ZP.setState({currentAmmPool:e})},[x,n]),(0,l.useEffect)(()=>{e&&t&&m()},[m,e,t]),(0,a.jsxs)(c.Z,{metaTitle:"Concentrated Pools - Raydium",children:[(0,a.jsx)(ep,{}),(0,a.jsx)("div",{className:"w-full flex justify-center items-center",children:(0,a.jsx)(eh,{})})]})}}},function(e){e.O(0,[7239,5830,2820,7664,7980,5194,5469,9774,2888,179],function(){return e(e.s=77742)}),_N_E=e.O()}]);